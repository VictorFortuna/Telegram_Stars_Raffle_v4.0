# FAIRNESS
Status: Draft v0.1

## 1. Цель
Обеспечить прозрачную и проверяемую процедуру выбора победителя.

## 2. Модель
Commit–Reveal: публикуем hash(seed) до генерации результата. После — раскрываем seed. Используем HMAC для вычисления победителя.

## 3. Алгоритм (кратко)
1. При достижении threshold → генерируем seed (128 бит random).
2. seed_hash = SHA256(seed).
3. Публикуем seed_hash.
4. После grace_period → собираем упорядоченный список user_id.
5. Формируем строку / JSON списка участников (детерминированно).
6. hmac = HMAC_SHA256(seed, participants_json).
7. Преобразуем hmac в большое число (hex → int).
8. winner_index = number mod N.
9. Победитель = список[winner_index].
10. Раскрываем seed, показываем промежуточные данные.

## 4. Формат seed / hash
- seed: 32 байта hex (64 hex символа).
- seed_hash: hex SHA256(seed).

## 5. Формула
winner_index = ( BigInt( HMAC_SHA256(seed, participants_json) ) ) mod N

## 6. Пример (будет добавлен позже)
TBD: Пример с 5 участниками.

## 7. Команды / API
- /fairness: показывает текущий seed_hash (если ready) или последний завершённый (seed, hash, проверка).
- /details <id>: раскрывает participants_hash + seed.

## 8. Хеш списка участников
participants_hash = SHA256(concat(user_id по порядку с разделителем ':'))  
Публично показываем participants_hash для completed раундов.

## 9. Потенциальные атаки
| Угроза | Митигирование |
| Задержка reveal | Авто reveal в коде сразу при draw |
| Подмена списка | Список фиксирован транзакцией + sequence |
| Предсказуемый seed | Используем криптостойкий randomBytes |
| Модификация перед draw | Статус блокирует добавления (ready -> drawing) |

## 10. Улучшения
- Добавить внешнее случайное значение (block hash, внешняя оракульная служба).
- Многоисточниковый seed (seed = HMAC(server_seed, external_entropy)).

## 11. Инструкция пользователю
1. Скопируйте seed (из сообщения победителя).
2. Примените SHA256 → должно совпасть с seed_hash.
3. Получите список участников (через /details <id>).
4. Соберите JSON (тот же порядок).
5. Посчитайте HMAC_SHA256(seed, json).
6. Возьмите hex → число → mod N → индекс.
7. Сравните с объявленным победителем.

## 12. TBD
- Пример проверки (добавим код).
- Утилита в WebApp «Проверить честность».

(Конец файла)
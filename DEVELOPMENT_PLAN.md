# DEVELOPMENT_PLAN
Status: Draft v0.1

## 1. Статус документа
Рабочий черновик. Используется как дорожная карта. Изменения фиксируются в PROGRESS_LOG.md.

## 2. Цели MVP (Этап 1–2)
- Один активный розыгрыш (raffle) в любой момент.
- Фиксированная ставка участия (1 виртуальная Star).
- Порог фонда (threshold) + автоматический старт через 24 часа даже если порог не достигнут.
- Честность: commit–reveal seed + HMAC для выбора победителя.
- Публичная базовая история + проверка через /fairness и WebApp.
- Админ-команды: /set_threshold, /force_start, /cancel_raffle.
- Виртуальный кошелёк (MODE=VIRTUAL) с возможностью дальнейшего перехода на реальные Stars.
- Mini App (WebApp) — базовый UI: состояние розыгрыша, участие, ожидание результата.

## 3. Этапы разработки
### 3.1 Этап 0: Инициализация
- Подготовка документации (готово).
- Определение .env параметров.
- Настройка репозитория и умного CI (готово).
- Планирование миграций БД (Supabase).

### 3.2 Этап 1: Бэкенд Core (CLI/Bot без WebApp)
- Структура проекта (директории).
- Supabase: таблицы users, raffles, raffle_entries, balances (виртуальные), system_settings (минимум).
- Domain-сервисы: RaffleService, FairnessService, WalletProvider (Virtual).
- Bot (Telegraf): команды /start, /join (или кнопка), /status, /fairness, /admin (меню упрощённо).
- Логика переходов состояний (collecting → ready → drawing → completed).
- Seed commit и reveal.

### 3.3 Этап 2: Fairness + аудит
- Таблицы transactions, audit_log.
- Логирование действий admin (threshold change, force_start, cancel, seed_commit, seed_reveal).
- Команда /details <raffle_id>.
- Хеширование списка участников.

### 3.4 Этап 3: Mini WebApp (MVP UI)
- HTTP API (REST) для: get current raffle, join, fairness info, basic history.
- WebApp контейнер: React/Vite (минимум).
- Поллинг 5–10s или SSE (если успеем).
- Валидация initData (Telegram WebApp API).

### 3.5 Этап 4: Расширения
- Автогенерация следующего raffle.
- /my статистика пользователя.
- Настройка /set_winner_share, /set_commission.
- Автостарт через 24 часа (крономеханизм или планировщик в процессе).

### 3.6 Этап 5: Переходная подготовка к реальным Stars
- Документ TELEGRAM_STARS_OPTIONS.md (анализ API).
- Абстракция StarsWalletProvider (TBD).
- Проверка лицензионных/правовых ограничений Telegram.

## 4. Критерии готовности фаз
- Этап 1 Done: можно вручную создать/провести розыгрыш через бота, логика честности базовая работает.
- Этап 2 Done: есть аудит и проверяемость seed + список.
- Этап 3 Done: WebApp отображает текущее состояние и позволяет вступить.
- Этап 4 Done: стабильность цикла (автосоздание), базовые метрики, пользовательская статистика.
- Этап 5 Done: документация и готовность интеграции.

## 5. Диаграмма зависимостей этапов
Этап 0 → 1 → 2 → 3 → (4 частично параллельно 3) → 5.

## 6. Риски и смягчение
- Отсутствие реальных Stars API: решение — виртуальный режим + адаптер.
- Доверие пользователей: прозрачный FAIRNESS.md + команды проверки.
- Низкая активность: автостарт через 24 часа.
- Технический долг WebApp: минимализм, затем постепенное расширение.

## 7. Roadmap после MVP
- Jackpot фонд.
- Multi-winner режим.
- Multi-entry (покупка дополнительных билетов).
- Реферальная система.
- Мультиязычность (EN).
- Real-time через WebSocket/SSE.
- Mini App Admin UI.

## 8. TBD / Открытые вопросы
- Реально доступные механизмы использования Stars (доп. исследование).
- Ограничения Telegram по монетизации.
- UX для fairness проверки в WebApp (всплывающее модальное окно?).

(Конец файла)
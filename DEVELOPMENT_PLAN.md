# Детальный План Реализации Проекта

Это дорожная карта разработки, разбитая на конкретные, измеримые задачи. Используйте чекбоксы для отслеживания прогресса.

**Легенда:**
*   `[ ]` - Задача не начата
*   `[/]` - Задача в процессе
*   `[x]` - Задача выполнена

---

### Этап 0: Подготовка и настройка окружения (1-2 дня)
**Цель: Создать скелет проекта, настроить сервер и подключение к базе данных.**

| №     | Задача                                         | Где делаем                                     | Как проверить                                                              | Статус |
| :---- | :--------------------------------------------- | :--------------------------------------------- | :------------------------------------------------------------------------- | :----: |
| **0.1** | Создание структуры папок                       | Корневая папка                                 | Все папки из `PROJECT_STRUCTURE.md` существуют.                            | `[ ]`  |
| **0.2** | Настройка Backend-сервера (Express + TS)       | `backend/`                                     | `npm install` в `backend/` проходит без ошибок.                            | `[ ]`  |
| **0.3** | Базовый Express-сервер с тестовым эндпоинтом   | `backend/src/server.ts`, `backend/src/app.ts`  | GET на `http://localhost:PORT/` возвращает `{"status":"ok"}`.              | `[ ]`  |
| **0.4** | Настройка переменных окружения (`.env`)        | `backend/.env.example`, `backend/.env`         | Сервер запускается и использует порт из `.env`.                            | `[ ]`  |
| **0.5** | Настройка подключения к БД (PostgreSQL)        | `backend/src/utils/database.ts`                | При запуске сервера в консоли есть лог об успешном подключении к БД.       | `[ ]`  |
| **0.6** | Создание первой миграции (таблица `users`)     | `database/migrations/001_create_users.sql`     | В БД появляется таблица `users` с нужными колонками.                       | `[ ]`  |

---

### Этап 1: MVP - Основной игровой цикл (5-7 дней)
**Цель: Реализовать основной сценарий: регистрация -> ставка -> розыгрыш.**

| №       | Задача                                         | Где делаем                                                               | Как проверить                                                               | Статус |
| :------ | :--------------------------------------------- | :----------------------------------------------------------------------- | :-------------------------------------------------------------------------- | :----: |
| **1.1.1** | Создание роутера и контроллера аутентификации  | `backend/src/routes/auth.routes.ts`, `.../controllers/auth.controller.ts` | POST на `/api/auth/telegram` возвращает `{"success": true}`.                | `[ ]`  |
| **1.1.2** | Создание сервиса аутентификации (логика)       | `backend/src/services/auth.service.ts`                                   | Метод `loginOrRegister` корректно создает/обновляет пользователя в БД.       | `[ ]`  |
| **1.1.3** | Генерация JWT-токена при успешной аутентификации | `backend/src/services/auth.service.ts`                                   | Успешный логин возвращает объект с полем `token`.                           | `[ ]`  |
| **1.1.4** | Настройка Frontend и логика отправки `initData`| `frontend/src/App.tsx`, `frontend/src/services/api.ts`                   | При открытии Mini App в `localStorage` браузера появляется JWT-токен.      | `[ ]`  |
| **1.2.1** | Миграции для таблиц `raffles` и `bets`         | `database/migrations/`                                                   | В БД появляются таблицы `raffles` и `bets`.                                | `[ ]`  |
| **1.2.2** | Middleware для проверки JWT-токена             | `backend/src/middleware/auth.middleware.ts`                              | Защищенный эндпоинт возвращает 401 без токена и 200 с валидным токеном.     | `[ ]`  |
| **1.2.3** | Создание эндпоинта и сервиса для ставок        | `backend/src/routes/bet...`, `.../services/bet...`                       | POST на `/api/bets` с токеном создает запись в таблице `bets`.              | `[ ]`  |
| **1.3.1** | Сервис для управления розыгрышами              | `backend/src/services/raffle.service.ts`                                 | Логика выбора победителя и смены статуса работает корректно в тестах.       | `[ ]`  |
| **1.3.2** | Автоматический запуск розыгрыша после ставки   | `backend/src/services/bet.service.ts`                                    | Когда кол-во ставок достигает цели, статус розыгрыша меняется на `finished`. | `[ ]`  |
| **1.3.3** | Настройка Telegram бота и сервиса уведомлений  | `bot/`, `bot/src/services/notification.service.ts`                       | Победитель розыгрыша получает сообщение от бота.                            | `[ ]`  |

---

### Этап 2: Расширение функционала и интеграция (4-5 дней)
**Цель: Подключить реальные платежи и сделать интерфейс более информативным.**

| №     | Задача                               | Где делаем                                  | Как проверить                                                               | Статус |
| :---- | :----------------------------------- | :------------------------------------------ | :-------------------------------------------------------------------------- | :----: |
| **2.1** | Интеграция с Telegram Stars API      | `backend/src/services/stars.service.ts`     | Перед созданием ставки у пользователя списывается 1 звезда через API.       | `[ ]`  |
| **2.2** | API для профиля и истории игр        | `backend/src/controllers/user.controller.ts`| GET на `/api/user/me` и `/api/user/history` возвращают корректные данные. | `[ ]`  |
| **2.3** | Frontend: страница профиля и истории | `frontend/src/pages/ProfilePage.tsx`, `.../HistoryPage.tsx` | В интерфейсе отображается баланс и список прошлых игр.                    | `[ ]`  |

---

### Этап 3: Запуск и поддержка (3-5 дней)
**Цель: Развернуть приложение и подготовить его к работе с реальными пользователями.**

| №     | Задача                           | Где делаем                                | Как проверить                                                          | Статус |
| :---- | :------------------------------- | :---------------------------------------- | :--------------------------------------------------------------------- | :----: |
| **3.1** | Настройка Docker для production  | `docker-compose.yml`                      | Проект успешно запускается командой `docker-compose up`.               | `[ ]`  |
| **3.2** | Настройка CI/CD для автодеплоя   | `.github/workflows/ci.yml`                | Push в `main` ветку автоматически запускает тесты и деплой.            | `[ ]`  |
| **3.3** | E2E (сквозное) тестирование      | -                                         | Полный пользовательский сценарий от входа до выигрыша проходит без ошибок. | `[ ]`  |
| **3.4** | Базовый мониторинг и логирование | -                                         | В системе логирования появляются ошибки и ключевые события.            | `[ ]`  |